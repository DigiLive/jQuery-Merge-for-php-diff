/*!
* jQuery-Merge-for-php-diff v0.3.2 - Copyright (c) 2014 Hannes Diercks <github@xiphe.net> - License: MIT
*/
!function(a){"use strict";function b(b,c){var d=this;d._id=1+g++,d.$el=a(b),d.options=a.extend({},f,c),d._defaults=f,d._name=e,d.$conflicts=a(),d.conflicts=[],d.toResolve=0,d.toMerge=0,d.inline=!1,d.result=[],d.lineOffset=0,d._tmpLineOffset=0,d._init()}function c(b,c){var d=this;d.$el=a(b),d.master=c,d._resolved=!1,d.type="",d.useLeft=!1,d.leftLine=0,d.rightLine=0,d.rowsLeft=0,d.rowsRight=0,d._init()}function d(a,b){var c=window.open("popup.html");b=b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),c.document.write("<html><head><title>"+a+"</title></head><body><pre>"+b+"</pre></body></html>")}var e="phpdiffmerge",f={left:"",right:"",debug:!1,pupupResult:!1,pupupSources:!1,merged:a.noop()},g=0;b.prototype={_init:function(){var b=this;return b._debug("PHPDiffMerge about to be initiated with options:",b.options),b.$conflicts=b.$el.find(".ChangeReplace, .ChangeDelete, .ChangeInsert"),b.toResolve=b.$conflicts.length,b.toResolve<=0||""===b.options.left&&""===b.options.right?(b._debug("Nothing to merge or merge sources not available - Please submit left and right on plug-in initiation!"),!1):(this.inline=b.$el.hasClass("DifferencesInline"),b._ensurePresenceOfMergeButton(),a.each(b.$conflicts,function(){b.conflicts.push(new c(this,b))}),b.$conflicts.on("xiphe_phpdiffmerge_resolved",a.proxy(b._conflictResolved,b)),b.$conflicts.on("xiphe_phpdiffmerge_merged",a.proxy(b._conflictMerged,b)),b.$conflicts.on("xiphe_phpdiffmerge_merged",a.proxy(b._updateLineOffset,b)),void b._debug("PHPDiffMerge initiated",b))},useRight:function(){var a=this;a.$conflicts.find("td.Right").click(),a.$el.hasClass("DifferencesInline")&&a.$el.find(".ChangeDelete td.Left").click().click()},useLeft:function(){var a=this;a.$conflicts.find("td.Left").click(),a.$el.hasClass("DifferencesInline")&&a.$el.find(".ChangeInsert td.Right").click().click()},merge:function(a){var b=this;if("undefined"!=typeof a&&null!==a&&a.preventDefault(),"disabled"===b.options.button.attr("disabled"))return void b._debug("Unable to merge: not all conflicts have been resolved.");b.result=b.options.left.slice(0),b.lineOffset=0,b.toMerge=b.$conflicts.length;for(var c=0;c<b.conflicts.length;c++)b.conflicts[c].merge()},option:function(b){var c=this;a.isPlainObject(b)&&(c.options=a.extend(!0,c.options,b))},_ensurePresenceOfMergeButton:function(){var b=this;"undefined"!=typeof b.options.button&&a(b.options.button).length?b.options.button=a(b.options.button).attr("disabled","disabled"):(b.options.button=a("<button />").html("Merge").attr("disabled","disabled").css({display:"block",height:"50px",width:"200px",margin:"50px auto"}),b.$el.after(b.options.button)),b.options.button.click(a.proxy(b.merge,b))},_debug:function(){this.options.debug&&window.console&&window.console.log&&window.console.log(Array.prototype.slice.call(arguments))},_conflictResolved:function(){var a=this;a.toResolve--,0===a.toResolve&&a.options.button.removeAttr("disabled")},_conflictMerged:function(){var a=this;a.toMerge--,0===a.toMerge&&(a.options.pupupResult&&d("end",a.result.join("\n")),a.options.pupupSources&&(d("left",a.options.left.join("\n")),d("right",a.options.right.join("\n"))),"function"==typeof a.options.merged&&a.options.merged.call(a,a.result,a.options.left,a.options.right))},_deleteResult:function(b,c){var d=this;d._debug("Deleting Left: "+b+" - "+(b+c-1)+".");var e=d.result.splice(b+d.lineOffset-1,c);d.options.debug&&(e=e.map(function(b){return a.trim(b).substring(0,10)+"..."}),d._debug("Content: ",e)),d._tmpLineOffset-=c},_insertResult:function(b,c,d){for(var e=this,f=[],g=0;c>g;g++){var h=e.options.right[b-1+g];f.push(h),e.result.splice(d-1+e.lineOffset+g,0,h)}e.options.debug&&(e._debug("Left line prior to insertion: "+(d-1)),e._debug("Content: ",a.trim(e.result[d-2+e.lineOffset]).substring(0,10)),e._debug("Inserted Right: Row "+b+" - "+(b+c-1)+"."),f=f.map(function(b){return a.trim(b).substring(0,10)+"..."}),e._debug("Content: ("+f.join(", ")+")")),e._tmpLineOffset+=c},_updateLineOffset:function(){var a=this;a._debug("Change lineOffset from: "+a.lineOffset+" to "+(a.lineOffset+a._tmpLineOffset)+"."),a.lineOffset+=a._tmpLineOffset,a._tmpLineOffset=0}},c.prototype={_init:function(){var b=this;b.type=b.$el.attr("class").match(/Change([\w]+)/)[1],b.$el.find("td").click(a.proxy(b._clicked,b)).hover(a.proxy(b._hoverIn,b),a.proxy(b._hoverOut,b)),b._setLine(),b._setRows(),b.master._debug("Conflict initiated:",b)},merge:function(){var a=this;if(a.useLeft)return a.master._debug("Ignoring lines "+a.leftLine+" - "+(a.leftLine+a.rowsLeft-1)+"."),void a.$el.trigger("xiphe_phpdiffmerge_merged");switch(a.master._debug("Merging Conflict:",a),a.type){case"Replace":a._delete(),a._insert();break;case"Insert":a._insert();break;case"Delete":a._delete();break;default:return void h('Undefined merge method "'+a.type+'".')}a.$el.trigger("xiphe_phpdiffmerge_merged")},_hoverIn:function(b){var c=a(b.delegateTarget),d=c.hasClass("Left")?"Left":"Right";this.$el.find("td."+d).addClass("hover")},_hoverOut:function(){this.$el.find("td.hover").removeClass("hover")},_clicked:function(b){var c,d,e=this,f=a(b.delegateTarget);if(e.master.inline?(e.useLeft=f.hasClass("use"),f.hasClass("Left")&&(e.useLeft=!e.useLeft)):e.useLeft=f.hasClass("Left"),c=e.useLeft?"Left":"Right",d=e.useLeft?"Right":"Left",!e.master.inline||"Delete"!==e.type&&"Insert"!==e.type)e.$el.find("td."+c).removeClass("dontUse").addClass("use"),e.$el.find("td."+d).removeClass("use").addClass("dontUse");else{var g=e.$el.find("td");g.toggleClass("use"),g.toggleClass("dontUse",!g.hasClass("use"))}e._resolved||(e._resolved=!0,e.$el.trigger("xiphe_phpdiffmerge_resolved"))},_setLine:function(){var a=this,b=a.$el.prev("tbody").find("tr").last();a.leftLine=parseInt(b.find("th").first().html()||0,10)+1,a.rightLine=parseInt(b.find("th").last().html()||0,10)+1},_setRows:function(){var b=this;b.master.inline?(b.rowsLeft=b.$el.find(".Left").length,b.rowsRight=b.$el.find(".Right").length):(b.rowsLeft=0,b.$el.find(".Left").each(function(){"&nbsp;"!==a(this).prev("th").html()&&b.rowsLeft++}),b.rowsRight=0,b.$el.find(".Right").each(function(){"&nbsp;"!==a(this).prev("th").html()&&b.rowsRight++}))},_insert:function(){var a=this;a.master._insertResult(a.rightLine,a.rowsRight,a.leftLine)},_delete:function(){var a=this;a.master._deleteResult(a.leftLine,a.rowsLeft)}};var h=function(a){window.console&&window.console.error(a)};a.fn[e]=function(c){var d=this;if("string"==typeof c){var f=Array.prototype.slice.call(arguments,1);d.each(function(){var b=a.data(this,"plugin_"+e);return b?a.isFunction(b[c])&&"_"!==c.charAt(0)?void b[c].apply(b,f):void h('no such method "'+c+'" for '+e+" instance"):void h("cannot call methods on "+e+' prior to initialization; attempted to call method "'+c+'"')})}else d.each(function(){var d=a.data(this,"plugin_"+e);d?(d.option(c),d._init()):a.data(this,"plugin_"+e,new b(this,c))});return d}}(jQuery);